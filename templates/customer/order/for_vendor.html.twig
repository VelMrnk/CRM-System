{% extends 'base.html.twig' %}

{% block body %}
    {{ form_start(form, {'attr': {'class': 'form-horizontal'} }) }}
        <div class="panel panel-default">
            <div class="panel-head">
                <h6><i class="icon-store2"></i> {{ 'customer.orders.for_vendors'|trans({}, 'labels') }} </h6>
            </div>
            <div class="panel-body parent">
                <div class="form-group {% if form.vendor.vars.errors | length > 0 %} has-error {% endif %}">
                    {{ form_label(form.vendor) }}
                    <div class="col-md-10 col-sm-9 col-xs-7">
                        {% if not form.vendor.vars.valid %}
                            {{ form_widget(form.vendor, {'attr': {
                                'data-placement': 'top',
                                'title': form.vendor.vars.errors[0].message,
                                'class': 'select tip tip-open'}
                            }) }}
                        {% else %}
                            {{ form_widget(form.vendor)}}
                        {% endif %}
                    </div>
                </div>
                <div class="form-group {% if form.orderDate.vars.errors | length > 0 %} has-error {% endif %}">
                    {{ form_label(form.orderDate) }}
                    <div class="col-md-10 col-sm-9 col-xs-7">
                        {% if not form.orderDate.vars.valid %}
                            {{ form_widget(form.orderDate, {'attr' : {
                                'data-placement': 'top',
                                'title': form.orderDate.vars.errors[0].message,
                                'class': 'datepicker form-control tip tip-open'}
                            }) }}
                        {% else %}
                            {{ form_widget(form.orderDate)}}
                        {% endif %}
                    </div>
                </div>
                <div class="form-actions text-right">
                    <button type="submit" class="btn btn-action">{{ 'button.add'|trans({}, 'labels') }}</button>
                </div>
            </div>
        </div>
    {{ form_end(form) }}

    {% if orders | length > 0 %}
        <div class="panel panel-default">
            <div class="table-vertical">
                <table class="table">
                    <thead>
                    <tr class="heading-style">
                        <th>{{ 'customer.orders.vendor'|trans({}, 'labels') }}</th>
                        <th>{{ 'customer.orders.order_date'|trans({}, 'labels') }}</th>
                        <th>{{ 'table.add_items'|trans({}, 'labels') }}</th>
                        <th>{{ 'table.delete'|trans({}, 'labels') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                        {% for key, order in orders %}
                            <tr class="parent{% if key is not divisible by (2) %} row-style {% endif %}">
                                <td class="form-group">{{ order.vendor.name }}</td>
                                <td class="form-group">{{ order.orderDate|date(app.user.getTwigFormatDate()) }}</td>
                                <td class="form-group">
                                    <button type="button"
                                            data-toggle="collapse"
                                            href="#products-{{ order.id }}"
                                            data-shareId="{{ order.id }}"
                                            class="btn btn-action btn-icon btn-products">
                                        <i class="icon-plus2"></i>
                                    </button>
                                </td>
                                <td class="form-group">
                                    <button type="button"
                                            data-path ="{{ path('member_order_delete', {orderId : order.id, role : 'vendor'}) }}"
                                            data-toggle="modal"
                                            href="#small_modal"
                                            class="btn btn-danger btn-icon btn-delete">
                                        <i class="icon-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="child">
                                <td colspan="5">
                                    <div id="products-{{ order.id }}" class="panel-collapse collapse in">
                                        <div class="panel-body">
                                            <!-- Include add product form -->
                                            {% include 'customer/order/templates/order_product_form.html.twig' with {
                                                'productForm': productsForms[order.id][0],
                                                role : 'vendor',
                                                'orderId': order.id
                                            } %}

                                            <!-- Include update products table list -->
                                            {% include 'customer/order/templates/order_products_table.html.twig' with {'forms' : productsForms[order.id]} %}
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% endif %}

    {{ include ("modal/delete-modal.html.twig") }}
{% endblock body %}